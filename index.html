<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Persuratan Sekolah</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel (untuk JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font & Styles -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Print styles - Adjusted for Folio (F4) */
        @media print {
            @page {
                size: 215mm 330mm; /* Ukuran Folio/F4 */
                margin: 0;
            }
            body {
                background: white;
            }
            .no-print {
                display: none !important;
            }
            .print-area {
                display: block !important;
                position: absolute;
                top: 0;
                left: 0;
                width: 215mm;
                height: 330mm;
                padding: 15mm 20mm; 
                margin: 0;
                box-shadow: none;
                overflow: visible;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- DEFINISI IKON ---
        const IconBase = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const FileText = (props) => <IconBase {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></IconBase>;
        const Plus = (props) => <IconBase {...props}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></IconBase>;
        const Trash2 = (props) => <IconBase {...props}><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></IconBase>;
        const Edit = (props) => <IconBase {...props}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></IconBase>;
        const Eye = (props) => <IconBase {...props}><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></IconBase>;
        const Printer = (props) => <IconBase {...props}><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></IconBase>;
        const Search = (props) => <IconBase {...props}><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></IconBase>;
        const LayoutDashboard = (props) => <IconBase {...props}><rect x="3" y="3" width="7" height="9"/><rect x="14" y="3" width="7" height="5"/><rect x="14" y="12" width="7" height="9"/><rect x="3" y="16" width="7" height="5"/></IconBase>;
        const FileWarning = (props) => <IconBase {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><path d="M12 9v4"/><path d="M12 17h.01"/></IconBase>;
        const FileSignature = (props) => <IconBase {...props}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><path d="M16 13H8"/><path d="M16 17H8"/><path d="M10 9H8"/></IconBase>;
        const Mail = (props) => <IconBase {...props}><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></IconBase>;
        const FileCheck = (props) => <IconBase {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="m9 15 2 2 4-4"/></IconBase>;
        const X = (props) => <IconBase {...props}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></IconBase>;
        const Save = (props) => <IconBase {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></IconBase>;
        const ArrowLeft = (props) => <IconBase {...props}><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></IconBase>;
        const Building2 = (props) => <IconBase {...props}><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/></IconBase>;
        const Menu = (props) => <IconBase {...props}><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></IconBase>;
        const Upload = (props) => <IconBase {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></IconBase>;
        const Download = (props) => <IconBase {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></IconBase>;
        const RotateCcw = (props) => <IconBase {...props}><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></IconBase>;
        const ChevronLeft = (props) => <IconBase {...props}><polyline points="15 18 9 12 15 6"/></IconBase>;
        const ChevronRight = (props) => <IconBase {...props}><polyline points="9 18 15 12 9 6"/></IconBase>;
        const SidebarOpen = (props) => <IconBase {...props}><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="9" y1="3" x2="9" y2="21"/></IconBase>;
        const ArrowRight = (props) => <IconBase {...props}><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></IconBase>;

        // --- LANDING PAGE COMPONENT ---
        function LandingPage({ onEnter }) {
            return (
                <div className="fixed inset-0 bg-slate-900 flex items-center justify-center z-50 p-4 font-sans text-white">
                    <div className="absolute inset-0 bg-gradient-to-br from-blue-900/20 to-slate-900 z-0"></div>
                    <div className="relative z-10 max-w-2xl w-full bg-slate-800/50 backdrop-blur-xl p-8 md:p-12 rounded-3xl shadow-2xl border border-slate-700 text-center animate-fade-in-up">
                        <div className="w-20 h-20 bg-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-8 shadow-blue-500/20 shadow-lg transform rotate-3 hover:rotate-6 transition-transform duration-300">
                            <FileText size={40} className="text-white" />
                        </div>
                        
                        <h1 className="text-3xl md:text-4xl font-bold mb-4 tracking-tight">Selamat Datang</h1>
                        <h2 className="text-xl md:text-2xl font-light text-blue-300 mb-6">Aplikasi Persuratan Sekolah</h2>
                        
                        <p className="text-slate-300 text-lg mb-8 leading-relaxed">
                            Aplikasi manajemen administrasi digital untuk mempermudah pembuatan, penyimpanan, dan pencetakan dokumen surat menyurat sekolah seperti Surat Skorsing, Pernyataan, Undangan, dan Kontrak Perilaku secara efisien.
                        </p>

                        <div className="inline-block bg-slate-900/50 px-6 py-3 rounded-full border border-slate-700 mb-10">
                            <p className="text-sm text-slate-400 font-mono">
                                Pengembang: <span className="text-blue-400 font-bold tracking-wide">MUHAMMAD HASRATUL</span>
                            </p>
                        </div>

                        <div>
                            <button 
                                onClick={onEnter} 
                                className="group bg-blue-600 hover:bg-blue-500 text-white text-lg px-8 py-3 rounded-full font-bold transition-all shadow-xl hover:shadow-blue-600/30 flex items-center gap-3 mx-auto transform hover:scale-105"
                            >
                                Masuk Aplikasi 
                                <ArrowRight size={20} className="group-hover:translate-x-1 transition-transform"/>
                            </button>
                        </div>
                    </div>
                    
                    <div className="absolute bottom-6 text-slate-600 text-xs">
                        &copy; {new Date().getFullYear()} Sistem Administrasi Sekolah
                    </div>
                </div>
            );
        }

        // --- APP LOGIC ---
        function App() {
            const [showLanding, setShowLanding] = useState(true);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
            const [isSidebarOpen, setIsSidebarOpen] = useState(true);
            
            // State
            const [itemsPerPage, setItemsPerPage] = useState(5);
            const [currentPage, setCurrentPage] = useState(1);
            const [schoolData, setSchoolData] = useState(() => {
                try {
                    return JSON.parse(localStorage.getItem('app_school_data')) || {
                        pemerintah: 'PEMERINTAH PROVINSI SULAWESI SELATAN',
                        instansi: 'DINAS PENDIDIKAN',
                        namaSekolah: 'SMK NEGERI CONTOH',
                        alamat: 'Jl. Pendidikan No. 123, Kota Makassar, Telp. (0411) 123456\nWebsite: www.smkcontoh.sch.id | Email: info@smkcontoh.sch.id',
                        logoKiri: 'https://upload.wikimedia.org/wikipedia/commons/9/9c/Logo_Provinsi_Sulawesi_Selatan.png', 
                        logoKanan: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9c/Tut_Wuri_Handayani.png/1200px-Tut_Wuri_Handayani.png'
                    };
                } catch { return {}; }
            });
            const [letters, setLetters] = useState(() => {
                try { return JSON.parse(localStorage.getItem('app_letters')) || []; } catch { return []; }
            });

            useEffect(() => { try { localStorage.setItem('app_school_data', JSON.stringify(schoolData)); } catch(e){} }, [schoolData]);
            useEffect(() => { try { localStorage.setItem('app_letters', JSON.stringify(letters)); } catch(e){} }, [letters]);

            const [viewState, setViewState] = useState('list');
            const [selectedLetter, setSelectedLetter] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');

            useEffect(() => { setCurrentPage(1); }, [activeTab, searchTerm, itemsPerPage]);

            const handleDelete = (id) => {
                if(window.confirm('Hapus surat ini?')) {
                    setLetters(letters.filter(l => l.id !== id));
                    if (selectedLetter && selectedLetter.id === id) { setViewState('list'); setSelectedLetter(null); }
                }
            };

            const handleSave = (formData) => {
                if (viewState === 'create') {
                    setLetters([ { ...formData, id: Date.now() }, ...letters ]);
                } else if (viewState === 'edit') {
                    setLetters(letters.map(l => l.id === selectedLetter.id ? { ...formData, id: l.id } : l));
                }
                setViewState('list');
                setSelectedLetter(null);
            };

            // DATA MANAGEMENT FUNCTIONS
            const handleBackup = () => {
                const data = JSON.stringify({ schoolData, letters }, null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `backup_surat_${new Date().toISOString().slice(0,10)}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const handleRestore = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const parsed = JSON.parse(event.target.result);
                        if (parsed.schoolData) setSchoolData(parsed.schoolData);
                        if (parsed.letters) setLetters(parsed.letters);
                        alert('Data berhasil dipulihkan!');
                    } catch (err) {
                        alert('File backup tidak valid!');
                    }
                };
                reader.readAsText(file);
            };

            const handleDeleteAll = () => {
                if(window.confirm('PERINGATAN: Semua data surat akan dihapus permanen! Pengaturan sekolah tetap tersimpan. Lanjutkan?')) {
                    setLetters([]);
                    alert('Semua data surat telah dihapus.');
                }
            };

            const filteredLetters = letters
                .filter(l => {
                    const search = searchTerm.toLowerCase();
                    const matchesSearch = (l.namaSiswa && l.namaSiswa.toLowerCase().includes(search)) || 
                                          (l.nomorSurat && l.nomorSurat.toLowerCase().includes(search));
                    if (activeTab === 'dashboard') return matchesSearch;
                    return matchesSearch && l.type === activeTab;
                })
                .sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));

            const indexOfLastItem = currentPage * itemsPerPage;
            const indexOfFirstItem = indexOfLastItem - itemsPerPage;
            const currentLetters = itemsPerPage === 'semua' ? filteredLetters : filteredLetters.slice(indexOfFirstItem, indexOfLastItem);
            const totalPages = itemsPerPage === 'semua' ? 1 : Math.ceil(filteredLetters.length / itemsPerPage);
            const headerDate = new Date().toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

            if (showLanding) {
                return <LandingPage onEnter={() => setShowLanding(false)} />;
            }

            return (
                <div className="min-h-screen bg-gray-100 flex font-sans text-gray-800">
                    <aside className={`bg-slate-900 text-white flex-col no-print sticky top-0 h-screen transition-all duration-300 hidden md:flex ${isSidebarOpen ? 'w-64' : 'w-0 overflow-hidden'}`}>
                        <SidebarContent activeTab={activeTab} setActiveTab={setActiveTab} setViewState={setViewState} />
                    </aside>

                    {isMobileMenuOpen && (
                        <div className="fixed inset-0 bg-black/50 z-40 md:hidden no-print" onClick={() => setIsMobileMenuOpen(false)}>
                            <div className="bg-slate-900 text-white w-64 h-full p-4" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-center mb-6"><h1 className="font-bold text-lg">Menu</h1><button onClick={() => setIsMobileMenuOpen(false)}><X size={24}/></button></div>
                                <SidebarContent activeTab={activeTab} setActiveTab={(tab) => { setActiveTab(tab); setIsMobileMenuOpen(false); }} setViewState={(view) => { setViewState(view); setIsMobileMenuOpen(false); }} />
                            </div>
                        </div>
                    )}

                    <main className="flex-1 overflow-x-hidden flex flex-col h-screen">
                        <header className="bg-white shadow-sm p-4 flex justify-between items-center no-print flex-shrink-0 sticky top-0 z-30">
                            <div className="flex items-center gap-3">
                                <button className="md:hidden text-gray-600 p-1 hover:bg-gray-100 rounded" onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}><Menu size={24} /></button>
                                <button className="hidden md:block text-gray-600 p-1 hover:bg-gray-100 rounded" onClick={() => setIsSidebarOpen(!isSidebarOpen)} title="Toggle Sidebar"><SidebarOpen size={24} /></button>
                                <div className="flex flex-col"><div className="font-bold text-lg md:text-xl text-slate-800 flex items-center gap-2"><span className="md:hidden">E-Surat</span><span className="hidden md:inline">Sistem Persuratan Sekolah</span></div></div>
                            </div>
                            <div className="flex items-center gap-3 text-right">
                                <div className="hidden sm:block"><p className="text-sm font-semibold text-gray-700">{headerDate}</p><p className="text-xs font-bold text-green-600">Mappaguru Online</p></div>
                                <div className="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold">A</div>
                            </div>
                        </header>

                        <div className="p-4 md:p-6 no-print overflow-auto flex-1">
                            {viewState === 'list' && (
                                <div className="space-y-6 pb-20">
                                    {activeTab === 'dashboard' && (
                                        <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
                                            <StatCard title="Total Surat" value={letters.length} icon={<FileText className="text-blue-500" />} color="bg-blue-50" />
                                            <StatCard title="Surat Skorsing" value={letters.filter(l => l.type === 'SKORSING').length} icon={<FileWarning className="text-red-500" />} color="bg-red-50" />
                                            <StatCard title="Surat Pernyataan" value={letters.filter(l => l.type === 'PERNYATAAN').length} icon={<FileSignature className="text-green-500" />} color="bg-green-50" />
                                            <StatCard title="Undangan/Kontrak" value={letters.filter(l => l.type === 'UNDANGAN' || l.type === 'KONTRAK').length} icon={<Mail className="text-purple-500" />} color="bg-purple-50" />
                                        </div>
                                    )}

                                    <div className="flex flex-col md:flex-row justify-between items-center gap-4">
                                        <div className="relative w-full md:w-auto">
                                            <Search className="absolute left-3 top-2.5 text-gray-400" size={20} />
                                            <input type="text" placeholder="Cari siswa / nomor..." className="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 w-full md:w-64" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                                        </div>
                                        <button onClick={() => {setSelectedLetter(null); setViewState('create');}} className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center justify-center gap-2 shadow-sm transition-colors w-full md:w-auto"><Plus size={20} /> <span className="hidden sm:inline">Buat</span> Surat Baru</button>
                                    </div>

                                    <div className="bg-white rounded-xl shadow-sm overflow-hidden border border-gray-100">
                                        <div className="p-4 border-b border-gray-100 flex items-center justify-between bg-gray-50">
                                            <div className="flex items-center gap-2 text-sm text-gray-600">
                                                <span>Show</span>
                                                <select value={itemsPerPage} onChange={(e) => setItemsPerPage(e.target.value === 'semua' ? 'semua' : Number(e.target.value))} className="border border-gray-300 rounded px-2 py-1"><option value={5}>5</option><option value={10}>10</option><option value={20}>20</option><option value={50}>50</option><option value="semua">Semua</option></select>
                                            </div>
                                            <div className="text-sm text-gray-500">Total: {filteredLetters.length}</div>
                                        </div>

                                        <div className="overflow-x-auto">
                                            <table className="w-full text-left min-w-[600px]">
                                                <thead className="bg-white text-gray-600 font-semibold border-b"><tr><th className="p-4 w-24">Jenis</th><th className="p-4">Nomor</th><th className="p-4">Siswa</th><th className="p-4 w-32">Tanggal</th><th className="p-4 text-center w-32">Aksi</th></tr></thead>
                                                <tbody className="divide-y divide-gray-100">
                                                    {currentLetters.length > 0 ? (
                                                        currentLetters.map((letter) => (
                                                            <tr key={letter.id} className="hover:bg-gray-50 transition-colors">
                                                                <td className="p-4"><span className="px-2 py-1 rounded-md text-[10px] sm:text-xs font-bold whitespace-nowrap bg-gray-100 text-gray-700">{letter.type}</span></td>
                                                                <td className="p-4 font-mono text-xs sm:text-sm text-gray-600">{letter.nomorSurat || '-'}</td>
                                                                <td className="p-4 font-medium text-sm">{letter.namaSiswa}<div className="text-gray-400 font-normal text-xs">{letter.kelas}</div></td>
                                                                <td className="p-4 text-gray-600 text-sm whitespace-nowrap">{formatDate(letter.tanggal)}</td>
                                                                <td className="p-4"><div className="flex justify-center gap-2"><button onClick={() => {setSelectedLetter(letter); setViewState('detail');}} className="p-2 hover:bg-blue-50 text-blue-600 rounded-full"><Eye size={18} /></button><button onClick={() => {setSelectedLetter(letter); setViewState('edit');}} className="p-2 hover:bg-orange-50 text-orange-600 rounded-full"><Edit size={18} /></button><button onClick={() => handleDelete(letter.id)} className="p-2 hover:bg-red-50 text-red-600 rounded-full"><Trash2 size={18} /></button></div></td>
                                                            </tr>
                                                        ))
                                                    ) : (<tr><td colSpan="5" className="p-8 text-center text-gray-400">Tidak ada data.</td></tr>)}
                                                </tbody>
                                            </table>
                                        </div>
                                        
                                        {itemsPerPage !== 'semua' && totalPages > 1 && (
                                            <div className="p-4 border-t border-gray-100 flex items-center justify-between bg-gray-50">
                                                <div className="text-sm text-gray-500">Hal {currentPage} dari {totalPages}</div>
                                                <div className="flex gap-2"><button onClick={() => setCurrentPage(p => Math.max(p - 1, 1))} disabled={currentPage === 1} className="p-2 border rounded bg-white disabled:opacity-50"><ChevronLeft size={16} /></button><button onClick={() => setCurrentPage(p => Math.min(p + 1, totalPages))} disabled={currentPage === totalPages} className="p-2 border rounded bg-white disabled:opacity-50"><ChevronRight size={16} /></button></div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}

                            {viewState === 'school_settings' && (
                                <SettingsView 
                                    schoolData={schoolData} 
                                    onSaveSchoolData={(data) => {setSchoolData(data); setViewState('list'); alert('Data sekolah disimpan!');}} 
                                    onCancel={() => setViewState('list')} 
                                    onBackup={handleBackup}
                                    onRestore={handleRestore}
                                    onDeleteAll={handleDeleteAll}
                                />
                            )}
                            {(viewState === 'create' || viewState === 'edit') && <LetterForm initialData={selectedLetter} onSave={handleSave} onCancel={() => {setViewState('list'); setSelectedLetter(null);}} />}
                            
                            {viewState === 'detail' && selectedLetter && (
                                <div className="flex flex-col h-full bg-gray-100">
                                    <div className="mb-4 flex justify-between items-center px-2">
                                        <button onClick={() => {setViewState('list'); setSelectedLetter(null);}} className="flex items-center gap-2 text-gray-600 bg-white px-4 py-2 rounded shadow-sm"><ArrowLeft size={20} /> Kembali</button>
                                        <button onClick={() => window.print()} className="bg-slate-800 text-white px-4 py-2 rounded flex items-center gap-2 shadow-lg"><Printer size={20} /> Cetak PDF</button>
                                    </div>
                                    <div className="overflow-auto flex-1 p-4 md:p-8 relative"><LetterContent data={selectedLetter} schoolData={schoolData} isPreview={true} /></div>
                                </div>
                            )}
                        </div>
                    </main>

                    {viewState === 'detail' && selectedLetter && (<div className="print-area hidden"><LetterContent data={selectedLetter} schoolData={schoolData} isPreview={false} /></div>)}
                </div>
            );
        }

        // --- COMPONENTS ---
        function SidebarContent({ activeTab, setActiveTab, setViewState }) {
            return (
                <div className="flex flex-col h-full">
                    <div className="p-6 border-b border-slate-700"><div className="flex items-center gap-2"><FileText className="text-blue-400" size={28} /><h1 className="text-xl font-bold whitespace-nowrap">E-Surat</h1></div><p className="text-xs text-slate-400 mt-2 whitespace-nowrap">Sistem Administrasi</p></div>
                    <nav className="flex-1 p-4 space-y-2 overflow-y-auto">
                        <SidebarItem icon={<LayoutDashboard size={20}/>} label="Dashboard" active={activeTab === 'dashboard'} onClick={() => {setActiveTab('dashboard'); setViewState('list');}} />
                        <div className="pt-4 pb-2 px-3 text-xs font-semibold text-slate-500 uppercase whitespace-nowrap">Jenis Surat</div>
                        <SidebarItem icon={<FileWarning size={20}/>} label="Surat Skorsing" active={activeTab === 'SKORSING'} onClick={() => {setActiveTab('SKORSING'); setViewState('list');}} />
                        <SidebarItem icon={<FileSignature size={20}/>} label="Surat Pernyataan" active={activeTab === 'PERNYATAAN'} onClick={() => {setActiveTab('PERNYATAAN'); setViewState('list');}} />
                        <SidebarItem icon={<Mail size={20}/>} label="Surat Undangan" active={activeTab === 'UNDANGAN'} onClick={() => {setActiveTab('UNDANGAN'); setViewState('list');}} />
                        <SidebarItem icon={<FileCheck size={20}/>} label="Kontrak Perilaku" active={activeTab === 'KONTRAK'} onClick={() => {setActiveTab('KONTRAK'); setViewState('list');}} />
                        <div className="pt-4 pb-2 px-3 text-xs font-semibold text-slate-500 uppercase whitespace-nowrap">Pengaturan</div>
                        <SidebarItem icon={<Building2 size={20}/>} label="Pengaturan" active={activeTab === 'SCHOOL_DATA'} onClick={() => {setActiveTab('SCHOOL_DATA'); setViewState('school_settings');}} />
                    </nav>
                    <div className="p-3 border-t border-slate-800 text-[10px] text-slate-500 text-center whitespace-nowrap">By MUHAMMAD HASRATUL</div>
                </div>
            );
        }

        function SidebarItem({ icon, label, active, onClick }) {
            return (<button onClick={onClick} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all overflow-hidden ${active ? 'bg-blue-600 text-white shadow-md' : 'text-slate-300 hover:bg-slate-800 hover:text-white'}`}><span className="shrink-0">{icon}</span><span className="font-medium text-sm whitespace-nowrap">{label}</span></button>);
        }

        function StatCard({ title, value, icon, color }) {
            return (<div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-center gap-4"><div className={`p-4 rounded-full ${color}`}>{icon}</div><div><p className="text-gray-500 text-sm font-medium">{title}</p><p className="text-2xl font-bold text-gray-800">{value}</p></div></div>);
        }

        function SettingsView({ schoolData, onSaveSchoolData, onCancel, onBackup, onRestore, onDeleteAll }) {
            const [tab, setTab] = useState('kop'); // 'kop' or 'data'
            
            // Internal form state for school data
            const [formData, setFormData] = useState(schoolData);
            const handleChange = (e) => setFormData({ ...formData, [e.target.name]: e.target.value });
            const handleImageUpload = (e, fieldName) => {
                const file = e.target.files[0];
                if (file) { const reader = new FileReader(); reader.onloadend = () => setFormData(prev => ({ ...prev, [fieldName]: reader.result })); reader.readAsDataURL(file); }
            };

            return (
                <div className="max-w-4xl mx-auto bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden mb-10">
                    <div className="bg-gray-50 px-4 md:px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                        <h2 className="text-lg font-bold text-gray-800">Pengaturan Aplikasi</h2>
                        <button onClick={onCancel}><X size={24} className="text-gray-400 hover:text-gray-600"/></button>
                    </div>
                    
                    {/* Tabs */}
                    <div className="flex border-b border-gray-200">
                        <button onClick={() => setTab('kop')} className={`flex-1 py-3 px-4 text-sm font-medium ${tab === 'kop' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-500 hover:text-gray-700'}`}>Kop Surat</button>
                        <button onClick={() => setTab('data')} className={`flex-1 py-3 px-4 text-sm font-medium ${tab === 'data' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-500 hover:text-gray-700'}`}>Backup & Reset</button>
                    </div>

                    <div className="p-6">
                        {tab === 'kop' && (
                            <form onSubmit={(e) => { e.preventDefault(); onSaveSchoolData(formData); }} className="space-y-6">
                                <div className="space-y-4">
                                    <h3 className="text-sm font-bold text-blue-800 uppercase border-b pb-2">1. Identitas Teks</h3>
                                    <div><label className="block text-sm font-medium text-gray-700">Pemerintah Daerah</label><input type="text" name="pemerintah" value={formData.pemerintah} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" required /></div>
                                    <div><label className="block text-sm font-medium text-gray-700">Instansi</label><input type="text" name="instansi" value={formData.instansi} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" required /></div>
                                    <div><label className="block text-sm font-medium text-gray-700">Nama Sekolah</label><input type="text" name="namaSekolah" value={formData.namaSekolah} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" required /></div>
                                    <div><label className="block text-sm font-medium text-gray-700">Alamat Lengkap</label><textarea name="alamat" value={formData.alamat} onChange={handleChange} rows="3" className="w-full p-2 border border-gray-300 rounded-md" required></textarea></div>
                                </div>
                                <div className="space-y-4">
                                    <h3 className="text-sm font-bold text-blue-800 uppercase border-b pb-2">2. Logo</h3>
                                    <div className="grid grid-cols-2 gap-6">
                                        <div><label className="block text-sm font-medium text-gray-700 mb-1">Logo Kiri</label><input type="file" accept="image/*" onChange={(e) => handleImageUpload(e, 'logoKiri')} className="block w-full text-xs text-gray-500 mb-2" /><input type="text" name="logoKiri" value={formData.logoKiri || ''} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md text-xs" placeholder="URL..." /></div>
                                        <div><label className="block text-sm font-medium text-gray-700 mb-1">Logo Kanan</label><input type="file" accept="image/*" onChange={(e) => handleImageUpload(e, 'logoKanan')} className="block w-full text-xs text-gray-500 mb-2" /><input type="text" name="logoKanan" value={formData.logoKanan || ''} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md text-xs" placeholder="URL..." /></div>
                                    </div>
                                </div>
                                <div className="flex justify-end pt-4"><button type="submit" className="px-6 py-2 bg-blue-600 text-white rounded-lg text-sm flex items-center gap-2"><Save size={16}/> Simpan Perubahan</button></div>
                            </form>
                        )}

                        {tab === 'data' && (
                            <div className="space-y-8">
                                <div className="bg-blue-50 p-4 rounded-lg border border-blue-100">
                                    <h3 className="font-bold text-blue-800 mb-2 flex items-center gap-2"><Download size={20}/> Backup Data</h3>
                                    <p className="text-sm text-gray-600 mb-4">Unduh file backup (.json) berisi semua data surat dan pengaturan sekolah.</p>
                                    <button onClick={onBackup} className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium">Download Backup</button>
                                </div>

                                <div className="bg-green-50 p-4 rounded-lg border border-green-100">
                                    <h3 className="font-bold text-green-800 mb-2 flex items-center gap-2"><Upload size={20}/> Restore Data</h3>
                                    <p className="text-sm text-gray-600 mb-4">Pulihkan data dari file backup (.json) yang pernah diunduh sebelumnya.</p>
                                    <input type="file" accept=".json" onChange={onRestore} className="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-green-600 file:text-white hover:file:bg-green-700"/>
                                </div>

                                <div className="bg-red-50 p-4 rounded-lg border border-red-100">
                                    <h3 className="font-bold text-red-800 mb-2 flex items-center gap-2"><RotateCcw size={20}/> Reset Aplikasi</h3>
                                    <p className="text-sm text-gray-600 mb-4">Hapus semua data surat secara permanen. Pengaturan kop surat tidak akan dihapus.</p>
                                    <button onClick={onDeleteAll} className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm font-medium">Hapus Semua Surat</button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function LetterForm({ initialData, onSave, onCancel }) {
            const defaults = { 
                type: 'SKORSING', 
                nomorSurat: '', 
                tanggal: new Date().toISOString().split('T')[0], 
                tempat: 'Makassar', 
                namaSiswa: '', nisn: '', jenisKelamin: 'Laki-laki', kelas: '', 
                alasan: '', lamaSkorsing: '', tanggalMulai: '', tanggalSelesai: '', 
                namaOrangTua: '', alamatOrangTua: '', noHpOrangTua: '', 
                isiPernyataan: '', 
                // Undangan specific
                hariTanggalAcara: '', waktuAcara: '', tempatAcara: '', keperluan: '',
                lampiran: '-', perihal: 'Undangan Orang Tua/Wali', namaWaliKelas: '', nipWaliKelas: '',
                // Kontrak specific
                tanggalKontrak: new Date().toISOString().split('T')[0], tanggalTinjauan: '',
                deskripsiPerilaku: '', tujuanPerubahan: '', rencanaTindakan: '', konsekuensi: '', statusKontrak: 'Aktif',
                penandaTangan: 'Drs. Kepala Sekolah', nipPenandaTangan: '', jabatan: 'Kepala Sekolah' 
            };
            const [formData, setFormData] = useState(initialData || defaults);
            const handleChange = (e) => setFormData(prev => ({ ...prev, [e.target.name]: e.target.value }));

            return (
                <div className="max-w-4xl mx-auto bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden mb-20">
                    <div className="bg-gray-50 px-4 md:px-6 py-4 border-b border-gray-200 flex justify-between items-center"><h2 className="text-lg font-bold text-gray-800">{initialData ? 'Edit Surat' : 'Buat Surat Baru'}</h2><button onClick={onCancel}><X size={24} className="text-gray-400 hover:text-gray-600" /></button></div>
                    <form onSubmit={(e) => { e.preventDefault(); onSave(formData); }} className="p-4 md:p-6 space-y-6">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="space-y-2"><label className="block text-sm font-medium text-gray-700">Jenis Surat</label><select name="type" value={formData.type} onChange={(e) => setFormData({...defaults, type: e.target.value})} disabled={!!initialData} className="w-full p-2 border border-gray-300 rounded-md"><option value="SKORSING">Surat Skorsing</option><option value="PERNYATAAN">Surat Pernyataan Orangtua</option><option value="UNDANGAN">Surat Undangan Orangtua</option><option value="KONTRAK">Kontrak Perilaku Siswa</option></select></div>
                            <div className="grid grid-cols-2 gap-4">
                                <div className="space-y-2"><label className="block text-sm font-medium text-gray-700">Tanggal Surat</label><input type="date" name="tanggal" value={formData.tanggal} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" required /></div>
                                <div className="space-y-2"><label className="block text-sm font-medium text-gray-700">Tempat Penetapan</label><input type="text" name="tempat" value={formData.tempat} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" required /></div>
                            </div>
                        </div>
                        
                        {/* DATA SISWA (Shared) */}
                        <div className="bg-blue-50 p-4 rounded-lg space-y-4">
                            <h3 className="font-semibold text-blue-800 text-sm uppercase">Identitas Siswa</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div><label className="block text-xs font-medium text-gray-600 mb-1">Nama Siswa</label><input type="text" name="namaSiswa" value={formData.namaSiswa} onChange={handleChange} className="w-full p-2 border border-blue-200 rounded-md" required /></div>
                                <div><label className="block text-xs font-medium text-gray-600 mb-1">NISN</label><input type="text" name="nisn" value={formData.nisn} onChange={handleChange} className="w-full p-2 border border-blue-200 rounded-md" /></div>
                                <div><label className="block text-xs font-medium text-gray-600 mb-1">Jenis Kelamin</label><select name="jenisKelamin" value={formData.jenisKelamin} onChange={handleChange} className="w-full p-2 border border-blue-200 rounded-md"><option value="Laki-laki">Laki-laki</option><option value="Perempuan">Perempuan</option></select></div>
                                <div><label className="block text-xs font-medium text-gray-600 mb-1">Kelas</label><input type="text" name="kelas" value={formData.kelas} onChange={handleChange} className="w-full p-2 border border-blue-200 rounded-md" required /></div>
                            </div>
                        </div>

                        {/* DATA ORANG TUA (Shared except Skorsing optional) */}
                        {formData.type !== 'SKORSING' && formData.type !== 'KONTRAK' && (
                            <div className="bg-green-50 p-4 rounded-lg space-y-4">
                                <h3 className="font-semibold text-green-800 text-sm uppercase">Identitas Orang Tua</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div><label className="block text-xs font-medium text-gray-600 mb-1">Nama Orang Tua</label><input type="text" name="namaOrangTua" value={formData.namaOrangTua} onChange={handleChange} className="w-full p-2 border border-green-200 rounded-md" required /></div>
                                    <div><label className="block text-xs font-medium text-gray-600 mb-1">No. HP</label><input type="text" name="noHpOrangTua" value={formData.noHpOrangTua} onChange={handleChange} className="w-full p-2 border border-green-200 rounded-md" /></div>
                                    <div className="md:col-span-2"><label className="block text-xs font-medium text-gray-600 mb-1">Alamat</label><input type="text" name="alamatOrangTua" value={formData.alamatOrangTua} onChange={handleChange} className="w-full p-2 border border-green-200 rounded-md" /></div>
                                </div>
                            </div>
                        )}

                        {/* FORM SPESIFIK */}
                        {formData.type === 'SKORSING' && (
                            <div className="space-y-4">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div><label className="block text-sm font-medium text-gray-700">Nomor Surat</label><input type="text" name="nomorSurat" value={formData.nomorSurat} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" required /></div>
                                    <div><label className="block text-sm font-medium text-gray-700">Nama Orang Tua (Tembusan)</label><input type="text" name="namaOrangTua" value={formData.namaOrangTua} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" required /></div>
                                </div>
                                <div><label className="block text-sm font-medium text-gray-700">Pelanggaran</label><textarea name="alasan" value={formData.alasan} onChange={handleChange} rows="3" className="w-full p-2 border border-gray-300 rounded-md" required></textarea></div>
                                <div className="grid grid-cols-3 gap-4">
                                    <div><label className="block text-sm font-medium text-gray-700">Lama</label><input type="text" name="lamaSkorsing" value={formData.lamaSkorsing} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" required /></div>
                                    <div><label className="block text-sm font-medium text-gray-700">Mulai</label><input type="date" name="tanggalMulai" value={formData.tanggalMulai} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" required /></div>
                                    <div><label className="block text-sm font-medium text-gray-700">Selesai</label><input type="date" name="tanggalSelesai" value={formData.tanggalSelesai} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" required /></div>
                                </div>
                            </div>
                        )}

                        {formData.type === 'PERNYATAAN' && (
                            <div><label className="block text-sm font-medium text-gray-700">Isi Pernyataan</label><textarea name="isiPernyataan" value={formData.isiPernyataan} onChange={handleChange} rows="4" className="w-full p-2 border border-gray-300 rounded-md" required /></div>
                        )}

                        {formData.type === 'UNDANGAN' && (
                            <div className="space-y-4 border-t pt-4">
                                <div className="grid grid-cols-2 gap-4">
                                    <div><label className="block text-sm font-medium text-gray-700">Nomor Surat</label><input type="text" name="nomorSurat" value={formData.nomorSurat} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" required /></div>
                                    <div><label className="block text-sm font-medium text-gray-700">Lampiran</label><input type="text" name="lampiran" value={formData.lampiran} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" /></div>
                                    <div className="col-span-2"><label className="block text-sm font-medium text-gray-700">Perihal</label><input type="text" name="perihal" value={formData.perihal} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" /></div>
                                    <div><label className="block text-sm font-medium text-gray-700">Hari/Tanggal Acara</label><input type="text" name="hariTanggalAcara" value={formData.hariTanggalAcara} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" placeholder="Senin, 10 Januari 2024" required /></div>
                                    <div><label className="block text-sm font-medium text-gray-700">Waktu Acara</label><input type="text" name="waktuAcara" value={formData.waktuAcara} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" placeholder="09.00 WITA - Selesai" required /></div>
                                    <div className="col-span-2"><label className="block text-sm font-medium text-gray-700">Tempat Acara</label><input type="text" name="tempatAcara" value={formData.tempatAcara} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" placeholder="Ruang Guru" required /></div>
                                </div>
                                <div><label className="block text-sm font-medium text-gray-700">Keperluan</label><textarea name="keperluan" value={formData.keperluan} onChange={handleChange} rows="2" className="w-full p-2 border border-gray-300 rounded-md" required></textarea></div>
                                <div className="bg-gray-100 p-4 rounded-md">
                                    <h4 className="font-semibold text-xs uppercase mb-2">Data Wali Kelas (Opsional)</h4>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div><label className="block text-xs font-medium text-gray-600">Nama Wali Kelas</label><input type="text" name="namaWaliKelas" value={formData.namaWaliKelas} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" /></div>
                                        <div><label className="block text-xs font-medium text-gray-600">NIP Wali Kelas</label><input type="text" name="nipWaliKelas" value={formData.nipWaliKelas} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" /></div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {formData.type === 'KONTRAK' && (
                            <div className="space-y-4 border-t pt-4">
                                <div className="grid grid-cols-2 gap-4">
                                    <div><label className="block text-sm font-medium text-gray-700">Tanggal Kontrak</label><input type="date" name="tanggalKontrak" value={formData.tanggalKontrak} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" /></div>
                                    <div><label className="block text-sm font-medium text-gray-700">Tanggal Tinjauan</label><input type="date" name="tanggalTinjauan" value={formData.tanggalTinjauan} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" /></div>
                                    <div><label className="block text-sm font-medium text-gray-700">Status Kontrak</label><select name="statusKontrak" value={formData.statusKontrak} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md"><option value="Aktif">Aktif</option><option value="Selesai">Selesai</option><option value="Dibatalkan">Dibatalkan</option></select></div>
                                </div>
                                <div><label className="block text-sm font-medium text-gray-700">Deskripsi Perilaku</label><textarea name="deskripsiPerilaku" value={formData.deskripsiPerilaku} onChange={handleChange} rows="2" className="w-full p-2 border border-gray-300 rounded-md" placeholder="Perilaku yang ingin diubah..."></textarea></div>
                                <div><label className="block text-sm font-medium text-gray-700">Tujuan Perubahan</label><textarea name="tujuanPerubahan" value={formData.tujuanPerubahan} onChange={handleChange} rows="2" className="w-full p-2 border border-gray-300 rounded-md" placeholder="Target perilaku baru..."></textarea></div>
                                <div><label className="block text-sm font-medium text-gray-700">Rencana Tindakan Siswa</label><textarea name="rencanaTindakan" value={formData.rencanaTindakan} onChange={handleChange} rows="2" className="w-full p-2 border border-gray-300 rounded-md" placeholder="Apa yang akan dilakukan siswa..."></textarea></div>
                                <div><label className="block text-sm font-medium text-gray-700">Konsekuensi (Positif/Negatif)</label><textarea name="konsekuensi" value={formData.konsekuensi} onChange={handleChange} rows="2" className="w-full p-2 border border-gray-300 rounded-md" placeholder="Hadiah jika berhasil / Sanksi jika gagal..."></textarea></div>
                            </div>
                        )}

                        {/* PENANDA TANGAN */}
                        <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                            <h3 className="font-semibold text-gray-800 text-sm uppercase mb-3">Pejabat Penanda Tangan</h3>
                            <div className="grid grid-cols-3 gap-4">
                                <div><label className="block text-sm font-medium text-gray-700">Nama</label><input type="text" name="penandaTangan" value={formData.penandaTangan} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" required /></div>
                                <div><label className="block text-sm font-medium text-gray-700">NIP</label><input type="text" name="nipPenandaTangan" value={formData.nipPenandaTangan} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" /></div>
                                <div><label className="block text-sm font-medium text-gray-700">Jabatan</label><input type="text" name="jabatan" value={formData.jabatan} onChange={handleChange} className="w-full p-2 border border-gray-300 rounded-md" required /></div>
                            </div>
                        </div>

                        <div className="flex justify-end gap-3 pt-4 pb-4"><button type="button" onClick={onCancel} className="px-4 py-2 text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg">Batal</button><button type="submit" className="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center gap-2 shadow-sm"><Save size={18} /> Simpan</button></div>
                    </form>
                </div>
            );
        }

        function LetterContent({ data, schoolData, isPreview }) {
            const containerClass = isPreview 
                ? "bg-white shadow-2xl mx-auto w-[215mm] min-h-[330mm] p-[15mm_20mm] relative text-black leading-normal text-[11pt] box-border"
                : "bg-white w-full h-full text-black leading-normal text-[11pt] box-border"; 
            
            // Inline style for forcing Arial in print and preview
            const arialStyle = { fontFamily: 'Arial, Helvetica, sans-serif' };

            return (
                <div className={containerClass} style={arialStyle}>
                    {/* KOP SURAT */}
                    <div className="border-b-4 border-double border-black pb-4 mb-4 flex items-center justify-between relative px-0">
                        <div className="w-[2.5cm] h-[2.5cm] flex items-center justify-center shrink-0">{schoolData.logoKiri && <img src={schoolData.logoKiri} alt="Logo" className="max-h-full max-w-full object-contain" />}</div>
                        <div className="text-center flex-1 px-2">
                            <h1 className="font-bold text-xl uppercase tracking-wider leading-tight">{schoolData.pemerintah}</h1>
                            <h1 className="font-bold text-lg uppercase tracking-wider leading-tight">{schoolData.instansi}</h1>
                            <h2 className="font-bold text-xl uppercase leading-tight">{schoolData.namaSekolah}</h2>
                            <p className="text-xs sm:text-sm italic mt-1 whitespace-pre-line leading-tight">{schoolData.alamat}</p>
                        </div>
                        <div className="w-[2.5cm] h-[2.5cm] flex items-center justify-center shrink-0">{schoolData.logoKanan && <img src={schoolData.logoKanan} alt="Logo" className="max-h-full max-w-full object-contain" />}</div>
                    </div>

                    {/* --- SURAT SKORSING --- */}
                    {data.type === 'SKORSING' && (
                        <div>
                            <div className="text-center mb-6"><h3 className="font-bold underline text-lg uppercase">SURAT KEPUTUSAN SKORSING</h3><p>Nomor: {data.nomorSurat}</p></div>
                            <p className="mb-2">Yang bertanda tangan di bawah ini:</p>
                            <table className="w-full mb-4"><tbody><tr><td className="w-40 align-top">Nama</td><td>: {data.penandaTangan}</td></tr><tr><td className="align-top">NIP</td><td>: {data.nipPenandaTangan || '-'}</td></tr><tr><td className="align-top">Jabatan</td><td>: {data.jabatan}</td></tr></tbody></table>
                            <p className="mb-2 text-justify">Berdasarkan hasil rapat Dewan Guru dan Tata Tertib Sekolah, dengan ini memberikan sanksi tegas berupa <strong>SKORSING (Pemberhentian Sementara)</strong> kepada siswa:</p>
                            <table className="w-full mb-4 pl-4"><tbody><tr><td className="w-40 align-top">Nama Siswa</td><td>: <strong>{data.namaSiswa}</strong></td></tr><tr><td className="align-top">NISN</td><td>: {data.nisn || '-'}</td></tr><tr><td className="align-top">Jenis Kelamin</td><td>: {data.jenisKelamin}</td></tr><tr><td className="align-top">Kelas</td><td>: {data.kelas}</td></tr><tr><td className="align-top">Pelanggaran</td><td className="text-justify">: {data.alasan}</td></tr></tbody></table>
                            <p className="mb-2 text-justify">Adapun masa skorsing berlaku selama <strong>{data.lamaSkorsing}</strong>, terhitung mulai tanggal <strong>{formatDate(data.tanggalMulai)}</strong> sampai dengan <strong>{formatDate(data.tanggalSelesai)}</strong>.</p>
                            <p className="mb-6 text-justify">Selama masa skorsing, siswa dikembalikan kepada orang tua/wali untuk dibina di rumah.</p>
                            <div className="flex justify-end mt-8 px-8"><div className="text-center w-64"><p className="mb-2">Ditetapkan di: {data.tempat || 'Makassar'}</p><p className="mb-2">Pada Tanggal: {formatDate(data.tanggal)}</p><p className="mb-16 font-bold">{data.jabatan},</p><p className="font-bold underline">{data.penandaTangan}</p><p>NIP. {data.nipPenandaTangan}</p></div></div>
                            <div className="mt-4 text-sm"><p>Tembusan:</p><ol className="list-decimal list-inside"><li>Orang Tua/Wali Siswa ({data.namaOrangTua})</li><li>Arsip</li></ol></div>
                        </div>
                    )}

                    {/* --- SURAT PERNYATAAN --- */}
                    {data.type === 'PERNYATAAN' && (
                        <div>
                            <div className="text-center mb-6"><h3 className="font-bold underline text-lg uppercase">SURAT PERNYATAAN ORANG TUA / WALI</h3></div>
                            <p className="mb-4">Saya yang bertanda tangan di bawah ini:</p>
                            <table className="w-full mb-4 pl-4"><tbody><tr><td className="w-48 py-1 align-top">Nama Orang Tua/Wali</td><td>: <strong>{data.namaOrangTua}</strong></td></tr><tr><td className="py-1 align-top">Alamat</td><td>: {data.alamatOrangTua}</td></tr><tr><td className="py-1 align-top">No. HP / WA</td><td>: {data.noHpOrangTua}</td></tr></tbody></table>
                            <p className="mb-2">Selaku Orang Tua / Wali dari siswa:</p>
                            <table className="w-full mb-6 pl-4"><tbody><tr><td className="w-48 py-1 align-top">Nama Siswa</td><td>: <strong>{data.namaSiswa}</strong></td></tr><tr><td className="py-1 align-top">NISN</td><td>: {data.nisn || '-'}</td></tr><tr><td className="py-1 align-top">Jenis Kelamin</td><td>: {data.jenisKelamin}</td></tr><tr><td className="py-1 align-top">Kelas</td><td>: {data.kelas}</td></tr></tbody></table>
                            <p className="mb-2 font-bold">Dengan ini menyatakan dengan sesungguhnya bahwa:</p>
                            <div className="border border-black p-4 mb-6 bg-gray-50 print:bg-transparent min-h-[100px] text-justify italic">"{data.isiPernyataan}"</div>
                            <p className="mb-6 text-justify">Demikian surat pernyataan ini saya buat dengan sadar tanpa paksaan dari pihak manapun.</p>
                            <div className="flex justify-between items-end mt-8 px-2">
                                <div className="text-center w-48 mb-8"><p className="mb-16">Siswa Yang Bersangkutan,</p><p className="font-bold underline whitespace-nowrap">{data.namaSiswa}</p><p className="text-sm">NIS. {data.nisn || '........................'}</p></div>
                                <div className="text-center w-64 mb-8"><p className="mb-2">{data.tempat || 'Makassar'}, {formatDate(data.tanggal)}</p><p className="mb-16">Orang Tua / Wali,</p><p className="font-bold underline whitespace-nowrap">{data.namaOrangTua}</p></div>
                            </div>
                            <div className="flex justify-center mt-2"><div className="text-center min-w-[200px]"><p className="mb-16">Mengetahui,<br/>{data.jabatan}</p><p className="font-bold underline">{data.penandaTangan}</p><p>NIP. {data.nipPenandaTangan}</p></div></div>
                        </div>
                    )}

                    {/* --- SURAT UNDANGAN --- */}
                    {data.type === 'UNDANGAN' && (
                        <div>
                            <div className="flex justify-between mb-4">
                                <div>
                                    <table className="leading-snug">
                                        <tbody>
                                            <tr><td>Nomor</td><td>: {data.nomorSurat}</td></tr>
                                            <tr><td>Lampiran</td><td>: {data.lampiran || '-'}</td></tr>
                                            <tr><td>Perihal</td><td className="font-bold">: {data.perihal || 'Undangan'}</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div className="text-right">
                                    <p>{data.tempat || 'Makassar'}, {formatDate(data.tanggal)}</p>
                                </div>
                            </div>
                            <p className="mb-2">Yth. Bapak/Ibu/Wali dari:</p>
                            <table className="w-full mb-4 pl-4">
                                <tbody>
                                    <tr><td className="w-40 align-top">Nama Siswa</td><td>: <strong>{data.namaSiswa}</strong></td></tr>
                                    <tr><td className="align-top">Kelas</td><td>: {data.kelas}</td></tr>
                                    <tr><td className="align-top">NISN</td><td>: {data.nisn || '-'}</td></tr>
                                </tbody>
                            </table>
                            <p className="mb-4">Di Tempat</p>
                            <p className="mb-4 text-justify">Dengan hormat,<br/>Sehubungan dengan pentingnya hal yang ingin kami sampaikan mengenai perkembangan putra/putri Bapak/Ibu, maka kami mengundang Bapak/Ibu untuk hadir di sekolah pada:</p>
                            <table className="w-full mb-6 pl-4">
                                <tbody>
                                    <tr><td className="w-40 py-1">Hari / Tanggal</td><td>: {data.hariTanggalAcara}</td></tr>
                                    <tr><td className="py-1">Waktu</td><td>: {data.waktuAcara}</td></tr>
                                    <tr><td className="py-1">Tempat</td><td>: {data.tempatAcara}</td></tr>
                                    <tr><td className="py-1 align-top">Keperluan</td><td className="align-top">: {data.keperluan}</td></tr>
                                </tbody>
                            </table>
                            <p className="mb-8 text-justify">Mengingat pentingnya acara tersebut, kami sangat mengharapkan kehadiran Bapak/Ibu tepat pada waktunya. Atas perhatian dan kerjasamanya kami ucapkan terima kasih.</p>
                            <div className="flex justify-between mt-12 px-8">
                                {data.namaWaliKelas && (
                                    <div className="text-center min-w-[200px]">
                                        <p className="mb-16">Mengetahui,<br/>Wali Kelas</p>
                                        <p className="font-bold underline">{data.namaWaliKelas}</p>
                                        <p>NIP. {data.nipWaliKelas || '-'}</p>
                                    </div>
                                )}
                                <div className="text-center min-w-[200px] ml-auto">
                                    <p className="mb-16">Mengetahui,<br/>{data.jabatan}</p>
                                    <p className="font-bold underline">{data.penandaTangan}</p>
                                    <p>NIP. {data.nipPenandaTangan}</p>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* --- KONTRAK PERILAKU --- */}
                    {data.type === 'KONTRAK' && (
                        <div>
                            <div className="text-center mb-4"><h3 className="font-bold underline text-lg uppercase">KONTRAK PERILAKU SISWA</h3></div>
                            
                            <table className="w-full mb-2 border-collapse border border-black text-sm">
                                <tbody>
                                    <tr><td className="border border-black p-1 font-bold bg-gray-100" colSpan="2">INFORMASI SISWA</td></tr>
                                    <tr><td className="border border-black p-1 w-48">Nama Siswa</td><td className="border border-black p-1 font-bold">{data.namaSiswa}</td></tr>
                                    <tr><td className="border border-black p-1">NISN</td><td className="border border-black p-1">{data.nisn}</td></tr>
                                    <tr><td className="border border-black p-1">Kelas / Gender</td><td className="border border-black p-1">{data.kelas} / {data.jenisKelamin}</td></tr>
                                    <tr><td className="border border-black p-1">Tanggal Kontrak</td><td className="border border-black p-1">{formatDate(data.tanggalKontrak)}</td></tr>
                                    <tr><td className="border border-black p-1">Tanggal Tinjauan</td><td className="border border-black p-1">{formatDate(data.tanggalTinjauan) || '-'}</td></tr>
                                </tbody>
                            </table>

                            <div className="space-y-2 text-sm">
                                <div className="border border-black p-1">
                                    <p className="font-bold underline mb-0.5">Deskripsi Perilaku yang Akan Diubah:</p>
                                    <p className="whitespace-pre-line leading-snug">{data.deskripsiPerilaku}</p>
                                </div>
                                <div className="border border-black p-1">
                                    <p className="font-bold underline mb-0.5">Tujuan Perubahan Perilaku:</p>
                                    <p className="whitespace-pre-line leading-snug">{data.tujuanPerubahan}</p>
                                </div>
                                <div className="border border-black p-1">
                                    <p className="font-bold underline mb-0.5">Rencana Tindakan Siswa:</p>
                                    <p className="whitespace-pre-line leading-snug">{data.rencanaTindakan}</p>
                                </div>
                                <div className="grid grid-cols-2 gap-2">
                                    <div className="border border-black p-1">
                                        <p className="font-bold underline mb-0.5">Konsekuensi:</p>
                                        <p className="whitespace-pre-line leading-snug">{data.konsekuensi}</p>
                                    </div>
                                    <div className="border border-black p-1">
                                        <p className="font-bold underline mb-0.5">Status Kontrak:</p>
                                        <p className="font-bold uppercase leading-snug">{data.statusKontrak}</p>
                                    </div>
                                </div>
                            </div>

                            <p className="mt-4 mb-2 text-justify text-sm leading-snug">Saya telah membaca dan memahami isi kontrak ini. Saya setuju untuk mengikuti rencana di atas dan menerima konsekuensi yang telah ditetapkan.</p>

                            <div className="flex justify-between items-end mt-4 px-2 text-sm">
                                <div className="text-center w-40 mb-8"><p className="mb-12">Siswa,</p><p className="font-bold underline whitespace-nowrap">{data.namaSiswa}</p></div>
                                <div className="text-center w-40 mb-8"><p className="mb-12">Orang Tua / Wali,</p><p className="font-bold underline">..............................</p></div>
                            </div>
                            <div className="flex justify-center mt-0 text-sm">
                                <div className="text-center min-w-[150px]">
                                    <p className="mb-1">Mengetahui,</p>
                                    <p className="mb-12">{data.jabatan}</p>
                                    <p className="font-bold underline">{data.penandaTangan}</p>
                                    <p>NIP. {data.nipPenandaTangan}</p>
                                </div>
                            </div>
                        </div>
                    )}

                </div>
            );
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            return new Date(dateString).toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' });
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
